* this update: 22-Sep-2017

* report program to extract salary sheet

DO IniSet1
DO SetVars
DO OpenDbfs
DO GetWagCd
DO SetRGets
DO GetVp
DO OutRpt

DO EndProg

*****************
PROCEDURE IniSet1
*****************

SET TALK OFF
SET SAFETY OFF
CLEAR
CLOSE DATABASES

RETURN
*****************


*****************
PROCEDURE SetVars
*****************

PUBLIC mMcode,mYear,Rmonth,Ryear,Rsalcode,title,mdescrip,Vp

mMcode = 0
mYear = 0
Rmonth = 0
Ryear = 0
Rsalcode = 0
title = SPACE(30)
mdescrip = SPACE(30)
Vp = SPACE(1)

RETURN
*****************

******************
PROCEDURE OpenDbfs
******************

SELECT 1
USE SalDtail ORDER empno

SELECT 2
USE attend ORDER empno

STORE mcode TO mMcode
STORE year TO mYear

	SELECT SalDtail
	SET FILTER TO
	SET FILTER TO mcode = mMcode AND year = mYear
	
SELECT 3
USE employee ORDER empno

SELECT 4
USE salary ORDER empno

SELECT 5
USE month ORDER mcode

SELECT 6
USE deduct ORDER empno
SET FILTER TO
SET FILTER TO mcode = mMcode AND year = mYear

SELECT 7
USE salcode ORDER salcode


SELECT SalDtail
SET RELATION TO str(deptcode)+str(empno)+str(mcode)+str(year) INTO attend ADDITIVE
SET RELATION TO str(deptcode)+str(empno) INTO employee ADDITIVE
SET RELATION TO str(deptcode)+str(empno) INTO salary ADDITIVE
SET RELATION TO mcode INTO month ADDITIVE
SET RELATION TO str(deptcode)+str(empno)+str(mcode)+str(year) INTO deduct ADDITIVE

RETURN
*****************************


**********************
PROCEDURE SetRGets
**********************

SELECT salcode
SEEK(Rsalcode)
title = salcode.descrip

SELECT saldtail
set filter to 
set filter to mcode = Rmonth AND year = Ryear AND salary.salcode = Rsalcode

SELECT deduct
set filter to
set filter to mcode = Rmonth AND year = Ryear


SELECT month
SEEK(Rmonth)
mdescrip = ALLTRIM(month.month)+","+ALLTRIM(STR(myear))

SELECT salary

SET FILTER TO
SET FILTER TO SALCODE = Rsalcode

SELECT 1

RETURN
****************************


**********************
PROCEDURE GetVp
**********************

******************************************************************
*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        07/31/96              GETVP.SPR                12:37:20 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 1996 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("getvp") ;
	OR UPPER(WTITLE("GETVP")) == "GETVP.PJX" ;
	OR UPPER(WTITLE("GETVP")) == "GETVP.SCX" ;
	OR UPPER(WTITLE("GETVP")) == "GETVP.MNX" ;
	OR UPPER(WTITLE("GETVP")) == "GETVP.PRG" ;
	OR UPPER(WTITLE("GETVP")) == "GETVP.FRX" ;
	OR UPPER(WTITLE("GETVP")) == "GETVP.QPR"
	DEFINE WINDOW getvp ;
		FROM INT((SROW()-10)/2),INT((SCOL()-40)/2) ;
		TO INT((SROW()-10)/2)+9,INT((SCOL()-40)/2)+39 ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		COLOR SCHEME 1
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                      GETVP/MS-DOS Screen Layout                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("getvp")
	ACTIVATE WINDOW getvp SAME
ELSE
	ACTIVATE WINDOW getvp NOSHOW
ENDIF
@ 1,4 SAY "Report to Printer or" ;
	SIZE 1,20, 0
@ 3,4 SAY "Preview (P/V)  ?" ;
	SIZE 1,16, 0
@ 3,25 GET vp ;
	SIZE 1,1 ;
	DEFAULT " " ;
	PICTURE "@!"

IF NOT WVISIBLE("getvp")
	ACTIVATE WINDOW getvp
ENDIF

READ MODAL

RELEASE WINDOW getvp

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF

RETURN
**********************

**********************
PROCEDURE OutRpt
**********************
IF UPPER(Vp) = "V"
	REPORT FORM sheetwag.frx PREVIEW
ENDIF
IF UPPER(Vp) = "P"
	??? CHR(15)
	REPORT FORM sheetwag.frx TO PRINTER NOEJECT
ENDIF
RETURN
************************


*******************
PROCEDURE EndProg
*******************
SET TALK ON
SET SAFETY ON
CLEAR
CLOSE DATA

RETURN
******************



*****************************
PROCEDURE PSalSht
*****************************
SELECT salsheet
SET ORDER TO mcode
SEEK(Rmonth)
@ 14,22 SAY salsheet.year
mdescrip = mdescrip + "," + ALLTRIM(str(salsheet.year))
SET ORDER TO sheetno
wait


??? CHR(15)
REPORT FORM sheetsal PREVIEW
RETURN
*********




**********************************
PROCEDURE GetWagCd
**********************************

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        08/26/96            GETWAGCD.SPR               17:11:15 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 1996 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("getsalcd") ;
	OR UPPER(WTITLE("GETSALCD")) == "GETSALCD.PJX" ;
	OR UPPER(WTITLE("GETSALCD")) == "GETSALCD.SCX" ;
	OR UPPER(WTITLE("GETSALCD")) == "GETSALCD.MNX" ;
	OR UPPER(WTITLE("GETSALCD")) == "GETSALCD.PRG" ;
	OR UPPER(WTITLE("GETSALCD")) == "GETSALCD.FRX" ;
	OR UPPER(WTITLE("GETSALCD")) == "GETSALCD.QPR"
	DEFINE WINDOW getsalcd ;
		FROM INT((SROW()-24)/2),INT((SCOL()-78)/2) ;
		TO INT((SROW()-24)/2)+23,INT((SCOL()-78)/2)+77 ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		COLOR SCHEME 1
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                GETWAGCD/MS-DOS Setup Code - SECTION 2          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
ryear = myear
rmonth = mMcode

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     GETWAGCD/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("getsalcd")
	ACTIVATE WINDOW getsalcd SAME
ELSE
	ACTIVATE WINDOW getsalcd NOSHOW
ENDIF
@ 1,28 SAY "-------------------" ;
	SIZE 1,19, 0
@ 3,3 SAY "Enter Salary Sheet Code :" ;
	SIZE 1,25, 0
@ 5,3 SAY "Enter Month  (1-12)     :" ;
	SIZE 1,25, 0
@ 7,3 SAY "Enter Year              :" ;
	SIZE 1,25, 0
@ 3,31 GET rsalcode ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "99" ;
	WHEN _rdb10u8fu() ;
	VALID _rdb10u8jw()
@ 3,35 GET title ;
	SIZE 1,30 ;
	DEFAULT " " ;
	DISABLE
@ 5,31 GET rmonth ;
	SIZE 1,2 ;
	RANGE 1, 12 ;
	DEFAULT 0 ;
	PICTURE "99"
@ 7,31 GET ryear ;
	SIZE 1,4 ;
	RANGE 1980, 2099 ;
	DEFAULT 0 ;
	PICTURE "9999"
@ 0,28 SAY "Report Wages Sheet" ;
	SIZE 1,18, 0

IF NOT WVISIBLE("getsalcd")
	ACTIVATE WINDOW getsalcd
ENDIF

READ MODAL

RELEASE WINDOW getsalcd

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     GETWAGCD/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1

******************


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*         GETWAGCD/MS-DOS Supporting Procedures and Functions    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
PROCEDURE ShwSalCd
******************
PUSH KEY

@ 20,0 TO 20,75 CLEAR

DEFINE WINDOW BrSalCd FROM 3,40 TO 20,75 DOUBLE;
	FOOTER "<Press Enter to Select Code>"
	
ACTIVATE WINDOW BrSalCd

SELECT salcode


ON KEY LABEL F5
ON KEY LABEL ENTER DO Slctd

BROW FIELDS;
	salcode :2 :H=" ",;
	descrip :H="Wages Sheets List";
IN WINDOW BrSalCd;
FOR type = "WAG";
NOEDIT NODELETE NOAPPEND

RELEASE WINDOW salcode
DEACTIVATE WINDOW BrSalCd
ON KEY LABEL ENTER

POP KEY

@ 20,20 SAY "Press F5 to See Wages Sheets List"

RETURN
***********

***************
PROCEDURE Slctd
***************

rsalcode = salcode.salcode
CLEAR GETS
SHOW GETS

RELEASE WINDOW salcode
DEACTIVATE WINDOW BrSalCd
ON KEY LABEL ENTER

RETURN
*********

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RDB10U8FU           rsalcode WHEN                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GETWAGCD,     Record Number:    6  
*        Variable:            rsalcode                           
*        Called By:           WHEN Clause                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rdb10u8fu     &&  rsalcode WHEN
#REGION 1
ON KEY LABEL F5 DO ShwSalCd

@ 20,20 SAY "Press F5 to See Wages Sheets List"

RETURN .T.

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RDB10U8JW           rsalcode VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GETWAGCD,     Record Number:    6  
*        Variable:            rsalcode                           
*        Called By:           VALID Clause                       
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rdb10u8jw     &&  rsalcode VALID
#REGION 1
SELECT salcode
SEEK(Rsalcode)
IF NOT FOUND()
WAIT WINDOW "Code does not Exist! Try Again." TIMEOUT 3
RETURN .F.
ENDIF


IF type <> "WAG"
WAIT WINDOW "This is Not a Wages Sheet! Please Re-Enter Code" TIMEOUT 3
RETURN .F.
ENDIF

STORE salcode.descrip TO title

CLEAR GETS
SHOW GETS

@ 20,0 TO 20,75 CLEAR


RETURN .T.


RETURN
*************************